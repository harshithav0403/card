<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>MindAR (Three.js) â€” Image â†’ 3D</title>

    <!-- MindAR Three adapter (UMD attaches to window.MINDAR) -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-three.prod.js"></script>

    <style>
      html, body { margin: 0; height: 100%; background: #000; overflow: hidden; }
      /* MindAR injects a canvas into the container. We use the whole page. */
      body > canvas { display: block; }
      #hint {
        position: fixed; left: 12px; bottom: 12px; z-index: 9999;
        color: #cfe7ff; background: rgba(0,0,0,.55);
        padding: 8px 12px; border-radius: 10px; font: 14px system-ui;
      }
    </style>
  </head>
  <body>
    <div id="hint">Loadingâ€¦ allow camera, then point at your picture.</div>

    <!-- Use ES modules for Three + GLTFLoader -->
    <script type="module">
      import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.module.js';
      import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.150.1/examples/jsm/loaders/GLTFLoader.js';

      const log = (m)=>{ const el = document.getElementById('hint'); if (el) el.textContent = m; console.log('[AR]', m); };

      // MindAR + Three setup (request 1280x720 so the view fills 16:9 screens)
      const mindarThree = new window.MINDAR.IMAGE.MindARThree({
        container: document.body,
        imageTargetSrc: './targets.mind',
        uiLoading: true, uiScanning: true, uiError: true,
        maxTrack: 1,
        video: { facingMode: 'environment', width: 1280, height: 720 } // 16:9
      });

      const { renderer, scene, camera } = mindarThree;

      // Basic lighting
      scene.add(new THREE.AmbientLight(0xffffff, 0.9));
      const dir = new THREE.DirectionalLight(0xffffff, 0.8);
      dir.position.set(0, 1, 1);
      scene.add(dir);

      // Anchor for target index 0
      const anchor = mindarThree.addAnchor(0);

      // Optional: a quick plane to visualize the target area (comment out if not needed)
      const planeGeo = new THREE.PlaneGeometry(1, 0.7);
      const planeMat = new THREE.MeshBasicMaterial({ color: 0x11ff11, opacity: 0.25, transparent: true });
      const plane = new THREE.Mesh(planeGeo, planeMat);
      anchor.group.add(plane);

      // Load your GLB model
      const loader = new GLTFLoader();
      loader.load('./hornet.glb', (gltf) => {
        const model = gltf.scene || gltf.scenes[0];
        model.scale.set(0.05, 0.05, 0.05);     // tweak if model looks big/small
        model.position.set(0, 0, 0.03);        // just above the plane
        model.rotation.set(0, 0, 0);
        anchor.group.add(model);
        log('Model loaded. Point at your target image.');
      }, undefined, (err) => {
        log('âŒ Failed to load model: ' + (err?.message || err));
      });

      // Helpful events
      anchor.onTargetFound = () => log('ðŸŽ¯ targetFound');
      anchor.onTargetLost  = () => log('ðŸ‘‹ targetLost');

      // Start AR
      try {
        await mindarThree.start();
        log('âœ… AR ready â€” scanningâ€¦');
        renderer.setAnimationLoop(() => {
          renderer.render(scene, camera);
        });
      } catch (e) {
        log('âŒ Could not start AR: ' + (e?.message || e));
      }

      // Surface any hidden errors to console
      window.addEventListener('error', e => console.warn('window error:', e.message || e));
      window.addEventListener('unhandledrejection', e => console.warn('promise rejection:', e.reason));
    </script>
  </body>
</html>
